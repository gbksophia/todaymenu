<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="recipe">
		<!-- 레시피 정보 입력 -->
	<insert id="insert" parameterType="recipeVO">
		insert into recipe(cate, cnum, main_name, title, mate, pro) 
		values (#{cate}, #{cnum}, #{main_name}, #{title}, #{mate}, #{pro})
	</insert>

	<!-- 레시피 리스트  출력 -->
	<select id="select" resultType="recipeVO" parameterType="String">
		select * from recipe where cate= #{cate}
	</select>

	<!-- 관심 레시피 랜덤 출력 -->
	<select id="memrandomSelect" resultType="recipeVO" parameterType="String">
	<![CDATA[select * from (select * from recipe where cate=#{value} order by DBMS_RANDOM.RANDOM ) where rownum <=5 ]]>
	</select>
	
	<!-- 관심 레시피 랜덤 출력 - 메인페이지 -->
	<select id="memrandomSelectIndex" resultType="recipeVO" parameterType="String">
	<![CDATA[select * from (select * from recipe where cate=#{value} order by DBMS_RANDOM.RANDOM ) where rownum <=12 ]]>
	</select>
	
	<!-- 관련 레시피 랜덤 출력 -->
	<select id="randomSelect" resultType="recipeVO" parameterType="recipeVO">
	<![CDATA[select * from (select * from recipe where cate=#{cate} order by DBMS_RANDOM.RANDOM ) where rownum <=5 and not cnum like #{cnum} ]]>
	</select>
	
	<!-- 레시피 정보 출력 -->
	<select id="info" resultType="recipeVO" parameterType="String">
		select * from recipe where cnum=#{cnum}
	</select>
	
	<select id = "selectPro" resultType="recipeImgVO">
		select * from recipe_pro
	</select>

		<!-- 레시피 갯수 카운트 -->	
	<select id="count" resultType="int">
		select count(*) from recipe
	</select>
	
		<!-- 레시피 카테고리 선택 -->
	<select id = "cateCount" resultType="int" parameterType = "String">
		select count(*) from recipe where cate = #{cate}
	</select>

	<!-- 레시피 조리법 이미지 검색 -->
	<select id="imgselect" resultType="recipeImgVO" parameterType="String" >
		select * from recipe_pro where cnum = #{cnum}
	</select>
 
 
 		<!-- 가장 선호하는 카테고리의 값 -->
	<select id="greatest" parameterType="String" resultType="int">
		select greatest (rice, soup, jeongol, side, shake, gui, jjim, guest, children, kimchi, dosi, fry, noodle, salad, spa, snack, toast, baking, dessert, juice, cocktail, holiday, drink) from mem where id=#{id}
	</select>
 
 	<!-- 위 값과 일치하는 카테고리의 이름 -->
	<select id="cate" parameterType="int" resultType="String">
		WITH t AS (SELECT rice, soup, jeongol, side, shake, gui, jjim, guest, children, kimchi, dosi, fry, noodle, salad, spa, snack, toast, baking, dessert, juice, cocktail, holiday, drink FROM mem)
    	SELECT * FROM t
    	UNPIVOT (yn FOR cnm IN (rice, soup, jeongol, side, shake, gui, jjim, guest, children, kimchi, dosi, fry, noodle, salad, spa, snack, toast, baking, dessert, juice, cocktail, holiday, drink))
		WHERE yn = #{value}
	</select>
 	<!-- 레시피 리뷰 이미지 이름 숫자 카운트 업 -->
 	<insert id="ImgcountInsert">
 		insert into fileNum values(fileNum_seq.nextval)
 	</insert>
 	
 	<!-- 레시피 리뷰 이미지 이름 숫자 카운트 가져오기 -->
 	<select id="ImgCount" resultType="int">
 		select max(num) from fileNum
 	</select>
 	
 	<!-- 레시피 리뷰 쓰기 -->
 	<insert id="ReviewInsert" parameterType="recipeReviewVO">
 		insert into recipe_re(num,cnum,id,nick,text,img,reg_date) values (recipe_re_seq.nextval,#{cnum},#{id},#{nick},#{text},#{img},sysdate)
 	</insert>
 	
 	<!-- 레시피 리뷰 갯수 -->
 	<select id="ReviewCount" parameterType="String" resultType="int">
 		select count(*) from recipe_re where cnum=#{value}
 	</select>
 	
 	<!-- 레시피 리뷰 가져오기 -->
 	<select id="reviewSelect" parameterType="String" resultType="recipeReviewVO">
 	   select * from recipe_re
 	   <if test="value != null">
 	    where cnum=#{cnum} 
 	    </if> 
 	    order by reg_date desc
 	</select>
 	
 	<!-- 회원 레시피 리뷰 리스트 -->
 	<select id="memReviewList" parameterType="String" resultType="recipeReviewVO">
 		select * from recipe_re where id=#{value}
 	</select>
 	
 	<!-- 레시피 리뷰 삭제 아이디값 비교 -->
 	<select id="idSelect" parameterType="int" resultType="String">
 	  select id from recipe_re where num=#{num}
 	</select>
 	
 	<!-- 레시피 리뷰 삭제 -->
 	<delete id="reviewDelete" parameterType="int">
 		delete from recipe_re where num = #{value}
 	</delete>
 	
 	<!-- 레시피 리뷰 수정 -->
 	<update id="reviewUpdate" parameterType="recipeReviewVO">
 		update recipe_re set text=#{text} where num=#{num} 
 	</update>
 	
 
 	<!-- 레시피 리뷰 텍스트 가져오기 -->
 	<select id="reviewText" parameterType="int" resultType="String">
 		select text from recipe_re where num=#{num}
 	</select>
 	
 	<!-- 레시피 리뷰 클릭 여부 체크 -->
 	<select id="reviewCheck" parameterType="recipeReviewNiceVO" resultType="int">
 		select count(*) from recipe_re_nice where renum=#{renum} and id=#{id}
 	</select>
 	
 	<!-- 레시피 리뷰 쪼아요 갯수 -->
 	<select id="niceCount" parameterType="int" resultType="int">
 		select count(*) from recipe_re_nice where renum=#{value}
 	</select>	
 	<!-- 레시피 리뷰 쪼아요 -->
 	<insert id="reviewNiceInsert" parameterType="recipeReviewNiceVO">
 		insert into recipe_re_nice values (recipe_re_nice_seq.nextval, #{id}, #{renum})
 	</insert>
 	
 	<!-- 레시피 리뷰 쪼아요 해제 -->
 	<delete id="reviewNiceDelete" parameterType="recipeReviewNiceVO">
 		delete from recipe_re_nice where id=#{id} and renum= #{renum}
 	</delete>
 	

 	<!-- 레시피 찜 체크 -->
 	<select id="jjimCheck" parameterType="recipeJjimVO" resultType="int">
 	  select count(*) from recipe_jjim where id=#{id} and cnum=#{cnum}
 	</select>
 	
 	<!-- 레시피 찜 추가 -->
 	<insert id="jjimInsert" parameterType="recipeJjimVO">
 		insert into recipe_jjim values(recipe_jjim_seq.nextval,#{id},#{cnum})
 	</insert>
 	
 	<!-- 레시피 찜 삭제 -->
 	<delete id="jjimDelete" parameterType="recipeJjimVO">
 		delete from recipe_jjim where id=#{id} and cnum=#{cnum}
 	</delete>
 	
 	<!-- 레시피 찜 리스트 -->
 	<select id="jjimList" parameterType="String" resultType="recipeVO">
 		select * from recipe r, recipe_jjim j where r.cnum=j.cnum and j.id= #{value}
 	</select>
 	
	<!-- 레시피 이름으로 검색 -->
 	<select id="searchRecTitle" parameterType="String" resultType="recipeVO" >
		<![CDATA[ select * from recipe where title like '%'||#{value}||'%']]>
	</select>
	
	<!-- 레시피 재료로 검색 -->
	<select id="searchRecMate" parameterType="String" resultType="recipeVO" >
		<![CDATA[select * from recipe where mate like '%'||#{value}||'%']]>
	</select>
	
	
 
</mapper>