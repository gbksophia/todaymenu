<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="restaurant">
	<insert id="insert" parameterType="rvo">
		insert into restaurant(num, cnum, store, area1, area2, addr, tel, cate) 
		values (restaurant_seq.nextval, #{cnum}, #{store}, #{area1}, #{area2}, #{addr}, #{tel}, #{cate})
	</insert>

	<select id="select" parameterType="String" resultType="rvo">
		select * from restaurant where cate = #{cate}
	</select>
	
	<select id="count" resultType="int">
		select count(*) from restaurant
	</select>
	
	<select id="search" parameterType="list" resultType="rvo">
		select * from (select * from restaurant where addr like '%'||#{list[0]}||'%') where area2 like '%'||#{list[1]}||'%'
	</select>
	
	<!-- 가장 선호하는 카테고리의 값 -->
	<select id="greatest" parameterType="String" resultType="int">
		select greatest (kor, china, japan, european, bunsig, cafe, etc) from mem where id=#{id}
	</select>
	
	<!-- 위 값과 일치하는 카테고리의 이름 -->
	<select id="cate" parameterType="int" resultType="String">
		WITH t AS (SELECT kor, china, japan, european, bunsig, cafe, etc FROM mem)
    	SELECT * FROM t
    	UNPIVOT (yn FOR cnm IN (kor, china, japan, european, bunsig, cafe, etc))
		WHERE yn = #{value}
	</select>
	
	<!-- 식당카테고리 기타 제외 -->
	<select id="restetc" resultType="rvo">
		select * from restaurant where cate not in ('한식', '중식', '일식', '양식', '분식', '카페')
	</select>
	
	<!-- 레시피 정보 출력 -->
	<select id="info" resultType="rvo" parameterType="String">
		select * from restaurant where cnum=#{cnum}
	</select>
</mapper>